<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Plot of the Shapley value explanations — plot.shapr • shapr</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot of the Shapley value explanations — plot.shapr"><meta name="description" content="Plots the individual prediction explanations."><meta property="og:description" content="Plots the individual prediction explanations."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/general_usage.html">General usage of shapr</a></li>
    <li><a class="dropdown-item" href="../articles/vaeac.html">Advanced usage of the `vaeac` approach</a></li>
    <li><a class="dropdown-item" href="../articles/regression.html">The separate and surrogate regression approches</a></li>
    <li><a class="dropdown-item" href="../articles/asymmetric_causal.html">Asymmetric and Causal Shapley values</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Manual</a></li>
<li class="nav-item"><a class="nav-link" href="../shaprpy.html">Python</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NorskRegnesentral/shapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Plot of the Shapley value explanations</h1>
      <small class="dont-index">Source: <a href="https://github.com/NorskRegnesentral/shapr/blob/v1.0.5/R/plot.R" class="external-link"><code>R/plot.R</code></a></small>
      <div class="d-none name"><code>plot.shapr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Plots the individual prediction explanations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'shapr'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  index_x_explain <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  top_k_features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bar_plot_phi0 <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  bar_plot_order <span class="op">=</span> <span class="st">"largest_first"</span>,</span>
<span>  scatter_features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scatter_hist <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_group_feature_means <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  beeswarm_cex <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">index_x_explain</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An <code>shapr</code> object.
The output from <code><a href="explain.html">explain()</a></code>.</p></dd>


<dt id="arg-plot-type">plot_type<a class="anchor" aria-label="anchor" href="#arg-plot-type"></a></dt>
<dd><p>Character.
Specifies the type of plot to produce.
<code>"bar"</code> (the default) gives a regular horizontal bar plot of the Shapley value magnitudes.
<code>"waterfall"</code> gives a waterfall plot indicating the changes in the prediction score due to each feature's
contribution (their Shapley values).
<code>"scatter"</code> plots the feature values on the x-axis and Shapley values on the y-axis, as well as
(optionally) a background scatter_hist showing the distribution of the feature data.
<code>"beeswarm"</code> summarizes the distribution of the Shapley values along the x-axis for all the features.
Each point gives the Shapley value of a given instance, where the points are colored by the feature value
of that instance.</p></dd>


<dt id="arg-digits">digits<a class="anchor" aria-label="anchor" href="#arg-digits"></a></dt>
<dd><p>Integer.
Number of significant digits to use in the feature description.
Applicable for <code>plot_type</code> <code>"bar"</code> and <code>"waterfall"</code></p></dd>


<dt id="arg-index-x-explain">index_x_explain<a class="anchor" aria-label="anchor" href="#arg-index-x-explain"></a></dt>
<dd><p>Integer vector.
Which of the test observations to plot. For example, if you have
explained 10 observations using <code><a href="explain.html">explain()</a></code>, you can generate a plot for the first five
observations by setting <code>index_x_explain = 1:5</code>.</p></dd>


<dt id="arg-top-k-features">top_k_features<a class="anchor" aria-label="anchor" href="#arg-top-k-features"></a></dt>
<dd><p>Integer.
How many features to include in the plot.
E.g. if you have 15 features in your model you can plot the 5 most important features,
for each explanation, by setting <code>top_k_features = 1:5</code>.
Applicable for <code>plot_type</code> <code>"bar"</code> and <code>"waterfall"</code></p></dd>


<dt id="arg-col">col<a class="anchor" aria-label="anchor" href="#arg-col"></a></dt>
<dd><p>Character vector (where length depends on plot type).
The color codes (hex codes or other names understood by <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot()</a></code>) for positive and negative
Shapley values, respectively.
The default is <code>col=NULL</code>, plotting with the default colors respective to the plot type.
For <code>plot_type = "bar"</code> and <code>plot_type = "waterfall"</code>, the default is <code>c("#00BA38","#F8766D")</code>.
For <code>plot_type = "beeswarm"</code>, the default is <code>c("#F8766D","yellow","#00BA38")</code>.
For <code>plot_type = "scatter"</code>, the default is <code>"#619CFF"</code>.</p>
<p>If you want to alter the colors in the plot, the length of the <code>col</code> vector depends on plot type.
For <code>plot_type = "bar"</code> or <code>plot_type = "waterfall"</code>, two colors should be provided, first for positive and
then for negative Shapley values.
For <code>plot_type = "beeswarm"</code>, either two or three colors can be given.
If two colors are given, then the first color determines the color that points with high feature values will have,
and the second determines the color of points with low feature values.
If three colors are given, then the first colors high feature values, the second colors mid-range feature values,
and the third colors low feature values.
For instance, <code>col = c("red", "yellow", "blue")</code> will make high values red, mid-range values yellow,
and low values blue.
For <code>plot_type = "scatter"</code>, a single color is to be given, which determines the color of the points on the
scatter plot.</p></dd>


<dt id="arg-bar-plot-phi-">bar_plot_phi0<a class="anchor" aria-label="anchor" href="#arg-bar-plot-phi-"></a></dt>
<dd><p>Logical.
Whether to include <code>phi0</code> in the plot for  <code>plot_type = "bar"</code>.</p></dd>


<dt id="arg-bar-plot-order">bar_plot_order<a class="anchor" aria-label="anchor" href="#arg-bar-plot-order"></a></dt>
<dd><p>Character.
Specifies what order to plot the features with respect to the magnitude of the Shapley values with
<code>plot_type = "bar"</code>:
<code>"largest_first"</code> (the default) plots the features ordered from largest to smallest absolute Shapley value.
<code>"smallest_first"</code> plots the features ordered from smallest to largest absolute Shapley value.
<code>"original"</code> plots the features in the original order of the data table.</p></dd>


<dt id="arg-scatter-features">scatter_features<a class="anchor" aria-label="anchor" href="#arg-scatter-features"></a></dt>
<dd><p>Integer or character vector.
Only used for <code>plot_type = "scatter"</code>.
Specifies which features to include in the scatter plot. Can be a numerical vector indicating feature index, or a
character vector, indicating the name(s) of the feature(s) to plot.</p></dd>


<dt id="arg-scatter-hist">scatter_hist<a class="anchor" aria-label="anchor" href="#arg-scatter-hist"></a></dt>
<dd><p>Logical.
Only used for <code>plot_type = "scatter"</code>.
Whether to include a scatter_hist indicating the distribution of the data when making the scatter plot. Note
that the bins are scaled so that when all the bins are stacked they fit the span of the y-axis of the plot.</p></dd>


<dt id="arg-include-group-feature-means">include_group_feature_means<a class="anchor" aria-label="anchor" href="#arg-include-group-feature-means"></a></dt>
<dd><p>Logical.
Whether to include the average feature value in a group on the y-axis or not.
If <code>FALSE</code> (default), then no value is shown for the groups. If <code>TRUE</code>, then <code>shapr</code> includes the mean of the
features in each group.</p></dd>


<dt id="arg-beeswarm-cex">beeswarm_cex<a class="anchor" aria-label="anchor" href="#arg-beeswarm-cex"></a></dt>
<dd><p>Numeric.
The cex argument of <code><a href="https://rdrr.io/pkg/ggbeeswarm/man/geom_beeswarm.html" class="external-link">ggbeeswarm::geom_beeswarm()</a></code>, controlling the spacing in the beeswarm plots.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments passed to underlying functions,
like <code><a href="https://rdrr.io/pkg/ggbeeswarm/man/geom_beeswarm.html" class="external-link">ggbeeswarm::geom_beeswarm()</a></code> for <code>plot_type = "beeswarm"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>ggplot object with plots of the Shapley value explanations</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See the examples below, or <code><a href="../articles/general_usage.html">vignette("general_usage", package = "shapr")</a></code> for examples of
how to use the function.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Martin Jullum, Vilde Ung, Lars Henry Berge Olsen</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"party"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"airquality"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">airquality</span> <span class="op">&lt;-</span> <span class="va">airquality</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">x_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Solar.R"</span>, <span class="st">"Wind"</span>, <span class="st">"Temp"</span>, <span class="st">"Month"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y_var</span> <span class="op">&lt;-</span> <span class="st">"Ozone"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Split data into test- and training data</span></span></span>
<span class="r-in"><span>  <span class="va">data_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">airquality</span>, <span class="op">-</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">data_explain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">airquality</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">data_train</span><span class="op">[</span>, <span class="va">x_var</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">x_explain</span> <span class="op">&lt;-</span> <span class="va">data_explain</span><span class="op">[</span>, <span class="va">x_var</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Fit a linear model</span></span></span>
<span class="r-in"><span>  <span class="va">lm_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">y_var</span>, <span class="st">" ~ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x_var</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">data_train</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Explain predictions</span></span></span>
<span class="r-in"><span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">[</span>, <span class="va">y_var</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Empirical approach</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="explain.html">explain</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>    x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>    x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>    approach <span class="op">=</span> <span class="st">"empirical"</span>,</span></span>
<span class="r-in"><span>    phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>    n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"ggbeeswarm"</span><span class="op">)</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># The default plotting option is a bar plot of the Shapley values</span></span></span>
<span class="r-in"><span>    <span class="co"># We draw bar plots for the first 4 observations</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, index_x_explain <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># We can also make waterfall plots</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"waterfall"</span>, index_x_explain <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># And only showing the two features with the largest contributions</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"waterfall"</span>, index_x_explain <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, top_k_features <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Or scatter plots showing the distribution of the Shapley values and feature values</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># And only for a specific feature</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"scatter"</span>, scatter_features <span class="op">=</span> <span class="st">"Temp"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Or a beeswarm plot summarising the Shapley values and feature values for all features</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"beeswarm"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"beeswarm"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="co"># we can change colors</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Additional arguments can be passed to ggbeeswarm::geom_beeswarm() using the '...' argument.</span></span></span>
<span class="r-in"><span>    <span class="co"># For instance, sometimes the beeswarm plots overlap too much.</span></span></span>
<span class="r-in"><span>    <span class="co"># This can be fixed with the 'corral="wrap" argument.</span></span></span>
<span class="r-in"><span>    <span class="co"># See ?ggbeeswarm::geom_beeswarm for more information.</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"beeswarm"</span>, corral <span class="op">=</span> <span class="st">"wrap"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Example of scatter and beeswarm plot with factor variables</span></span></span>
<span class="r-in"><span>  <span class="va">airquality</span><span class="op">$</span><span class="va">Month_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">month.abb</span><span class="op">[</span><span class="va">airquality</span><span class="op">$</span><span class="va">Month</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">airquality</span> <span class="op">&lt;-</span> <span class="va">airquality</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">x_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Solar.R"</span>, <span class="st">"Wind"</span>, <span class="st">"Temp"</span>, <span class="st">"Month_factor"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y_var</span> <span class="op">&lt;-</span> <span class="st">"Ozone"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Split data into test- and training data</span></span></span>
<span class="r-in"><span>  <span class="va">data_train</span> <span class="op">&lt;-</span> <span class="va">airquality</span></span></span>
<span class="r-in"><span>  <span class="va">data_explain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">airquality</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">data_train</span><span class="op">[</span>, <span class="va">x_var</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">x_explain</span> <span class="op">&lt;-</span> <span class="va">data_explain</span><span class="op">[</span>, <span class="va">x_var</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Fit a linear model</span></span></span>
<span class="r-in"><span>  <span class="va">lm_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">y_var</span>, <span class="st">" ~ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x_var</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">data_train</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Explain predictions</span></span></span>
<span class="r-in"><span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">[</span>, <span class="va">y_var</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Empirical approach</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="explain.html">explain</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>    x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>    x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>    approach <span class="op">=</span> <span class="st">"ctree"</span>,</span></span>
<span class="r-in"><span>    phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>    n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"ggbeeswarm"</span><span class="op">)</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plot_type <span class="op">=</span> <span class="st">"beeswarm"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 14:08:24</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">empirical</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">50</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/Rtmp1me5uE/shapr_obj_1f123ca13689.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 14:08:31</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">ctree</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">50</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/Rtmp1me5uE/shapr_obj_1f124b8255ae.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-plt img"><img src="plot.shapr-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Jullum, Lars Henry Berge Olsen, Annabelle Redelmeier, Jon Lachmann, Nikolai Sellereite, Norsk Regnesentral.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

