<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Define coalitions, and fetch additional information about each unique coalition — create_coalition_table • shapr</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Define coalitions, and fetch additional information about each unique coalition — create_coalition_table"><meta name="description" content="Define coalitions, and fetch additional information about each unique coalition"><meta property="og:description" content="Define coalitions, and fetch additional information about each unique coalition"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/general_usage.html">General usage of shapr</a></li>
    <li><a class="dropdown-item" href="../articles/vaeac.html">Advanced usage of the `vaeac` approach</a></li>
    <li><a class="dropdown-item" href="../articles/regression.html">The separate and surrogate regression approches</a></li>
    <li><a class="dropdown-item" href="../articles/asymmetric_causal.html">Asymmetric and Causal Shapley values</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Manual</a></li>
<li class="nav-item"><a class="nav-link" href="../shaprpy.html">Python</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NorskRegnesentral/shapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Define coalitions, and fetch additional information about each unique coalition</h1>
      <small class="dont-index">Source: <a href="https://github.com/NorskRegnesentral/shapr/blob/master/R/shapley_setup.R" class="external-link"><code>R/shapley_setup.R</code></a></small>
      <div class="d-none name"><code>create_coalition_table.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Define coalitions, and fetch additional information about each unique coalition</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">create_coalition_table</span><span class="op">(</span></span>
<span>  <span class="va">m</span>,</span>
<span>  exact <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_coalitions <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  n_coal_each_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">choose</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">m</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  weight_zero_m <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span>,</span>
<span>  paired_shap_sampling <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prev_X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_samps_scale <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  coal_feature_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  approach0 <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  kernelSHAP_reweighting <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  semi_deterministic_sampling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dt_coal_samp_info <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dt_valid_causal_coalitions <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>Positive integer.
Total number of features/groups.</p></dd>


<dt id="arg-exact">exact<a class="anchor" aria-label="anchor" href="#arg-exact"></a></dt>
<dd><p>Logical.
If <code>TRUE</code> all <code>2^m</code> coalitions are generated, otherwise a subsample of the coalitions is used.</p></dd>


<dt id="arg-n-coalitions">n_coalitions<a class="anchor" aria-label="anchor" href="#arg-n-coalitions"></a></dt>
<dd><p>Positive integer.
Note that if <code>exact = TRUE</code>, <code>n_coalitions</code> is ignored.</p></dd>


<dt id="arg-n-coal-each-size">n_coal_each_size<a class="anchor" aria-label="anchor" href="#arg-n-coal-each-size"></a></dt>
<dd><p>Vector of integers of length <code>m-1</code>. The number of valid coalitions of each coalition size
1, 2,..., m-1. For symmetric Shapley values, this is <code>choose(m, seq(m-1))</code> (default). While for asymmetric Shapley
values, this is the number of valid coalitions of each size in the causal ordering. Used to correctly normalize the
Shapley weights.</p></dd>


<dt id="arg-weight-zero-m">weight_zero_m<a class="anchor" aria-label="anchor" href="#arg-weight-zero-m"></a></dt>
<dd><p>Numeric.
The value to use as a replacement for infinite coalition weights when doing numerical operations.</p></dd>


<dt id="arg-paired-shap-sampling">paired_shap_sampling<a class="anchor" aria-label="anchor" href="#arg-paired-shap-sampling"></a></dt>
<dd><p>Logical.
Whether to do paired sampling of coalitions.</p></dd>


<dt id="arg-prev-x">prev_X<a class="anchor" aria-label="anchor" href="#arg-prev-x"></a></dt>
<dd><p>data.table. The X data.table from the previous iteration.</p></dd>


<dt id="arg-n-samps-scale">n_samps_scale<a class="anchor" aria-label="anchor" href="#arg-n-samps-scale"></a></dt>
<dd><p>Positive integer.
Integer that scales the number of coalitions <code>n_coalitions</code> to sample as sampling is cheap,
while checking for <code>n_coalitions</code> unique coalitions is expensive, thus we over sample the
number of coalitions by a factor of <code>n_samps_scale</code> and determine when we have <code>n_coalitions</code> unique
coalitions and only use the coalitions up to this point and throw away the remaining coalitions.</p></dd>


<dt id="arg-coal-feature-list">coal_feature_list<a class="anchor" aria-label="anchor" href="#arg-coal-feature-list"></a></dt>
<dd><p>List.
A list mapping each coalition to the features it contains.</p></dd>


<dt id="arg-approach-">approach0<a class="anchor" aria-label="anchor" href="#arg-approach-"></a></dt>
<dd><p>Character vector.
Contains the approach to be used for estimation of each coalition size. Same as <code>approach</code> in <code><a href="explain.html">explain()</a></code>.</p></dd>


<dt id="arg-kernelshap-reweighting">kernelSHAP_reweighting<a class="anchor" aria-label="anchor" href="#arg-kernelshap-reweighting"></a></dt>
<dd><p>String.
How to reweight the sampling frequency weights in the kernelSHAP solution after sampling.
The aim of this is to reduce the randomness and thereby the variance of the Shapley value estimates.
The options are one of <code>'none'</code>, <code>'on_N'</code>, <code>'on_all'</code>, <code>'on_all_cond'</code> (default).
<code>'none'</code> means no reweighting, i.e. the sampling frequency weights are used as is.
<code>'on_N'</code> means the sampling frequencies are averaged over all coalitions with the same original sampling
probabilities.
<code>'on_all'</code> means the original sampling probabilities are used for all coalitions.
<code>'on_all_cond'</code> means the original sampling probabilities are used for all coalitions, while adjusting for the
probability that they are sampled at least once.
<code>'on_all_cond'</code> is preferred as it performs the best in simulation studies, see
<a href="https://arxiv.org/pdf/2410.04883" class="external-link">Olsen &amp; Jullum (2024)</a>.</p></dd>


<dt id="arg-semi-deterministic-sampling">semi_deterministic_sampling<a class="anchor" aria-label="anchor" href="#arg-semi-deterministic-sampling"></a></dt>
<dd><p>Logical.
If <code>FALSE</code> (default), then we sample from all coalitions.
If <code>TRUE</code>, the sampling of coalitions is semi-deterministic, i.e. the sampling is done in a way that ensures that
coalitions that are expected to be sampled based on the number of coalitions are deterministically included such
that we sample among fewer coalitions. This is done to reduce the variance of the Shapley value estimates,
and corresponds to the PySHAP* strategy in the paper <a href="https://arxiv.org/pdf/2410.04883" class="external-link">Olsen &amp; Jullum (2024)</a>.</p></dd>


<dt id="arg-dt-coal-samp-info">dt_coal_samp_info<a class="anchor" aria-label="anchor" href="#arg-dt-coal-samp-info"></a></dt>
<dd><p>data.table. The data.table contains information about which coalitions should be
deterministically included and which can be sampled, in addition to the sampling probabilities of each available
coalition size, and the weight given to the sampled and deterministically included coalitions (excluding empty and
grand coalitions which are given the <code>weight_zero_m</code> weight).</p></dd>


<dt id="arg-dt-valid-causal-coalitions">dt_valid_causal_coalitions<a class="anchor" aria-label="anchor" href="#arg-dt-valid-causal-coalitions"></a></dt>
<dd><p>data.table. Only applicable for asymmetric Shapley
value explanations, and is <code>NULL</code> for symmetric Shapley values.
The data.table contains information about the coalitions that respects the causal ordering.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table with info about the coalitions to use</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nikolai Sellereite, Martin Jullum, Lars Henry Berge Olsen</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Jullum, Lars Henry Berge Olsen, Annabelle Redelmeier, Jon Lachmann, Nikolai Sellereite, Norsk Regnesentral.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

