<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Explain the output of machine learning models with dependence-aware (conditional/observational) Shapley values — explain • shapr</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Explain the output of machine learning models with dependence-aware (conditional/observational) Shapley values — explain"><meta name="description" content="Compute dependence-aware Shapley values for observations in x_explain from the specified
model using the method specified in approach to estimate the conditional expectation.
See Aas et al. (2021)
for a thorough introduction to dependence-aware prediction explanation with Shapley values.
For an overview of the methodology and capabilities of the package, see the software paper
Jullum et al. (2025), or the pkgdown site at
norskregnesentral.github.io/shapr/."><meta property="og:description" content="Compute dependence-aware Shapley values for observations in x_explain from the specified
model using the method specified in approach to estimate the conditional expectation.
See Aas et al. (2021)
for a thorough introduction to dependence-aware prediction explanation with Shapley values.
For an overview of the methodology and capabilities of the package, see the software paper
Jullum et al. (2025), or the pkgdown site at
norskregnesentral.github.io/shapr/."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/general_usage.html">General usage of shapr</a></li>
    <li><a class="dropdown-item" href="../articles/vaeac.html">Advanced usage of the `vaeac` approach</a></li>
    <li><a class="dropdown-item" href="../articles/regression.html">The separate and surrogate regression approches</a></li>
    <li><a class="dropdown-item" href="../articles/asymmetric_causal.html">Asymmetric and Causal Shapley values</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Manual</a></li>
<li class="nav-item"><a class="nav-link" href="../shaprpy.html">Python</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NorskRegnesentral/shapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Explain the output of machine learning models with dependence-aware (conditional/observational) Shapley values</h1>
      <small class="dont-index">Source: <a href="https://github.com/NorskRegnesentral/shapr/blob/master/R/explain.R" class="external-link"><code>R/explain.R</code></a></small>
      <div class="d-none name"><code>explain.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute dependence-aware Shapley values for observations in <code>x_explain</code> from the specified
<code>model</code> using the method specified in <code>approach</code> to estimate the conditional expectation.
See <a href="https://martinjullum.com/publication/aas-2021-explaining/aas-2021-explaining.pdf" class="external-link">Aas et al. (2021)</a>
for a thorough introduction to dependence-aware prediction explanation with Shapley values.
For an overview of the methodology and capabilities of the package, see the software paper
<a href="https://arxiv.org/pdf/2504.01842" class="external-link">Jullum et al. (2025)</a>, or the pkgdown site at
<a href="https://norskregnesentral.github.io/shapr/">norskregnesentral.github.io/shapr/</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">explain</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">x_explain</span>,</span>
<span>  <span class="va">x_train</span>,</span>
<span>  <span class="va">approach</span>,</span>
<span>  <span class="va">phi0</span>,</span>
<span>  iterative <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_n_coalitions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_MC_samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="st">"basic"</span>,</span>
<span>  predict_model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  get_model_specs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prev_shapr_object <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  asymmetric <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  causal_ordering <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  confounding <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extra_computation_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  iterative_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Model object.
The model whose predictions you want to explain.
Run <code><a href="get_supported_models.html">get_supported_models()</a></code>
for a table of which models <code>explain</code> supports natively. Unsupported models
can still be explained by passing <code>predict_model</code> and (optionally) <code>get_model_specs</code>,
see details for more information.</p></dd>


<dt id="arg-x-explain">x_explain<a class="anchor" aria-label="anchor" href="#arg-x-explain"></a></dt>
<dd><p>Matrix or data.frame/data.table.
Features for which predictions should be explained.</p></dd>


<dt id="arg-x-train">x_train<a class="anchor" aria-label="anchor" href="#arg-x-train"></a></dt>
<dd><p>Matrix or data.frame/data.table.
Data used to estimate the (conditional) feature distributions
needed to properly estimate the conditional expectations in the Shapley formula.</p></dd>


<dt id="arg-approach">approach<a class="anchor" aria-label="anchor" href="#arg-approach"></a></dt>
<dd><p>Character vector of length <code>1</code> or one less than the number of features.
All elements should either be <code>"gaussian"</code>, <code>"copula"</code>, <code>"empirical"</code>, <code>"ctree"</code>, <code>"vaeac"</code>,
<code>"categorical"</code>, <code>"timeseries"</code>, <code>"independence"</code>, <code>"regression_separate"</code>, or <code>"regression_surrogate"</code>.
The two regression approaches cannot be combined with any other approach.
See details for more information.</p></dd>


<dt id="arg-phi-">phi0<a class="anchor" aria-label="anchor" href="#arg-phi-"></a></dt>
<dd><p>Numeric.
The prediction value for unseen data, i.e., an estimate of the expected prediction without conditioning on any
features.
Typically set this equal to the mean of the response in the training data, but alternatives such as the mean
of the training predictions are also reasonable.</p></dd>


<dt id="arg-iterative">iterative<a class="anchor" aria-label="anchor" href="#arg-iterative"></a></dt>
<dd><p>Logical or NULL.
If <code>NULL</code> (default), set to <code>TRUE</code> if there are more than 5 features/groups, and <code>FALSE</code> otherwise.
If <code>TRUE</code>, Shapley values are estimated iteratively for faster, sufficiently accurate results.
First an initial number of coalitions is sampled, then bootstrapping estimates the variance of the Shapley values.
A convergence criterion determines if the variances are sufficiently small. If not, additional samples are added.
The process repeats until the variances are below the threshold.
Specifics for the iterative process and convergence criterion are set via <code>iterative_args</code>.</p></dd>


<dt id="arg-max-n-coalitions">max_n_coalitions<a class="anchor" aria-label="anchor" href="#arg-max-n-coalitions"></a></dt>
<dd><p>Integer.
Upper limit on the number of unique feature/group coalitions to use in the iterative procedure
(if <code>iterative = TRUE</code>).
If <code>iterative = FALSE</code>, it represents the number of feature/group coalitions to use directly.
The quantity refers to the number of unique feature coalitions if <code>group = NULL</code>,
and group coalitions if <code>group != NULL</code>.
<code>max_n_coalitions = NULL</code> corresponds to <code>2^n_features</code>.</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>List.
If <code>NULL</code>, regular feature-wise Shapley values are computed.
If provided, group-wise Shapley values are computed.
<code>group</code> then has length equal to the number of groups.
Each list element contains the character vectors with the features included in the corresponding group.
See
<a href="https://martinjullum.com/publication/jullum-2021-efficient/jullum-2021-efficient.pdf" class="external-link">Jullum et al. (2021)</a>
for more information on group-wise Shapley values.</p></dd>


<dt id="arg-n-mc-samples">n_MC_samples<a class="anchor" aria-label="anchor" href="#arg-n-mc-samples"></a></dt>
<dd><p>Positive integer.
For most approaches, it indicates the maximum number of samples to use in the Monte Carlo integration
of every conditional expectation.
For <code>approach="ctree"</code>, <code>n_MC_samples</code> corresponds to the number of samples
from the leaf node (see an exception related to the <code>ctree.sample</code> argument in <code><a href="setup_approach.html">setup_approach.ctree()</a></code>).
For <code>approach="empirical"</code>, <code>n_MC_samples</code> is the \(K\) parameter in equations (14-15) of
Aas et al. (2021), i.e. the maximum number of observations (with largest weights) that is used, see also the
<code>empirical.eta</code> argument <code><a href="setup_approach.html">setup_approach.empirical()</a></code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Positive integer.
Specifies the seed before any code involving randomness is run.
If <code>NULL</code> (default), no seed is set in the calling environment.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>String vector or NULL.
Controls verbosity (printout detail level) via one or more of <code>"basic"</code>, <code>"progress"</code>,
<code>"convergence"</code>, <code>"shapley"</code> and <code>"vS_details"</code>.
<code>"basic"</code> (default) displays basic information about the computation and messages about parameters/checks.
<code>"progress"</code> displays where in the calculation process the function currently is.
<code>"convergence"</code> displays how close the Shapley value estimates are to convergence
(only when <code>iterative = TRUE</code>).
<code>"shapley"</code> displays intermediate Shapley value estimates and standard deviations (only when <code>iterative = TRUE</code>),
and the final estimates.
<code>"vS_details"</code> displays information about the v(S) estimates,
most relevant for <code>approach %in% c("regression_separate", "regression_surrogate", "vaeac")</code>.
<code>NULL</code> means no printout.
Any combination can be used, e.g., <code>verbose = c("basic", "vS_details")</code>.</p></dd>


<dt id="arg-predict-model">predict_model<a class="anchor" aria-label="anchor" href="#arg-predict-model"></a></dt>
<dd><p>Function.
Prediction function to use when <code>model</code> is not natively supported.
(Run <code><a href="get_supported_models.html">get_supported_models()</a></code> for a list of natively supported models.)
The function must have two arguments, <code>model</code> and <code>newdata</code>, which specify the model
and a data.frame/data.table to compute predictions for, respectively.
The function must give the prediction as a numeric vector.
<code>NULL</code> (the default) uses functions specified internally.
Can also be used to override the default function for natively supported model classes.</p></dd>


<dt id="arg-get-model-specs">get_model_specs<a class="anchor" aria-label="anchor" href="#arg-get-model-specs"></a></dt>
<dd><p>Function.
An optional function for checking model/data consistency when <code>model</code> is not natively supported.
(Run <code><a href="get_supported_models.html">get_supported_models()</a></code> for a list of natively supported models.)
The function takes <code>model</code> as an argument and provides a list with 3 elements:</p><dl><dt>labels</dt>
<dd><p>Character vector with the names of each feature.</p></dd>

<dt>classes</dt>
<dd><p>Character vector with the class of each feature.</p></dd>

<dt>factor_levels</dt>
<dd><p>Character vector with the levels for any categorical features.</p></dd>


</dl><p>If <code>NULL</code> (the default), internal functions are used for natively supported model classes, and checking is
disabled for unsupported model classes.
Can also be used to override the default function for natively supported model classes.</p></dd>


<dt id="arg-prev-shapr-object">prev_shapr_object<a class="anchor" aria-label="anchor" href="#arg-prev-shapr-object"></a></dt>
<dd><p><code>shapr</code> object or string.
If an object of class <code>shapr</code> is provided, or a string with a path to where intermediate results are stored,
then the function will use the previous object to continue the computation.
This is useful if the computation is interrupted or you want higher accuracy than already obtained, and therefore
want to continue the iterative estimation. See the
<a href="https://norskregnesentral.github.io/shapr/articles/general_usage.html">general usage vignette</a> for examples.</p></dd>


<dt id="arg-asymmetric">asymmetric<a class="anchor" aria-label="anchor" href="#arg-asymmetric"></a></dt>
<dd><p>Logical.
Not applicable for (regular) non-causal explanations.
If <code>FALSE</code> (default), <code>explain</code> computes regular symmetric Shapley values.
If <code>TRUE</code>, <code>explain</code> computes asymmetric Shapley values based on the (partial) causal ordering
given by <code>causal_ordering</code>. That is, <code>explain</code> only uses feature coalitions that
respect the causal ordering. If <code>asymmetric</code> is <code>TRUE</code> and
<code>confounding</code> is <code>NULL</code> (default), <code>explain</code> computes asymmetric conditional Shapley values as specified in
<a href="https://proceedings.neurips.cc/paper_files/paper/2020/file/0d770c496aa3da6d2c3f2bd19e7b9d6b-Paper.pdf" class="external-link">
Frye et al. (2020)</a>. If <code>confounding</code> is provided, i.e., not <code>NULL</code>, then <code>explain</code> computes asymmetric causal
Shapley values as specified in
<a href="https://proceedings.neurips.cc/paper/2020/file/32e54441e6382a7fbacbbbaf3c450059-Paper.pdf" class="external-link">
Heskes et al. (2020)</a>.</p></dd>


<dt id="arg-causal-ordering">causal_ordering<a class="anchor" aria-label="anchor" href="#arg-causal-ordering"></a></dt>
<dd><p>List.
Not applicable for (regular) non-causal or asymmetric explanations.
<code>causal_ordering</code> is an unnamed list of vectors specifying the components of the
partial causal ordering that the coalitions must respect. Each vector represents
a component and contains one or more features/groups identified by their names
(strings) or indices (integers). If <code>causal_ordering</code> is <code>NULL</code> (default), no causal
ordering is assumed and all possible coalitions are allowed. No causal ordering is
equivalent to a causal ordering with a single component that includes all features
(<code>list(1:n_features)</code>) or groups (<code>list(1:n_groups)</code>) for feature-wise and group-wise
Shapley values, respectively. For feature-wise Shapley values and
<code>causal_ordering = list(c(1, 2), c(3, 4))</code>, the interpretation is that features 1 and 2
are the ancestors of features 3 and 4, while features 3 and 4 are on the same level.
Note: All features/groups must be included in <code>causal_ordering</code> without duplicates.</p></dd>


<dt id="arg-confounding">confounding<a class="anchor" aria-label="anchor" href="#arg-confounding"></a></dt>
<dd><p>Logical vector.
Not applicable for (regular) non-causal or asymmetric explanations.
<code>confounding</code> is a logical vector specifying whether confounding is assumed for each component in the
<code>causal_ordering</code>. If <code>NULL</code> (default), no assumption about the confounding structure is made and <code>explain</code>
computes asymmetric/symmetric conditional Shapley values, depending on <code>asymmetric</code>.
If <code>confounding</code> is a single logical (<code>FALSE</code> or <code>TRUE</code>), the assumption is set globally
for all components in the causal ordering. Otherwise, <code>confounding</code> must have the same
length as <code>causal_ordering</code>, indicating the confounding assumption for each component. When <code>confounding</code> is
specified, <code>explain</code> computes asymmetric/symmetric causal Shapley values, depending on <code>asymmetric</code>.
The <code>approach</code> cannot be <code>regression_separate</code> or <code>regression_surrogate</code>, as the
regression-based approaches are not applicable to the causal Shapley methodology.</p></dd>


<dt id="arg-extra-computation-args">extra_computation_args<a class="anchor" aria-label="anchor" href="#arg-extra-computation-args"></a></dt>
<dd><p>Named list.
Specifies extra arguments related to the computation of the Shapley values.
See <code><a href="get_extra_comp_args_default.html">get_extra_comp_args_default()</a></code> for description of the arguments and their default values.</p></dd>


<dt id="arg-iterative-args">iterative_args<a class="anchor" aria-label="anchor" href="#arg-iterative-args"></a></dt>
<dd><p>Named list.
Specifies the arguments for the iterative procedure.
See <code><a href="get_iterative_args_default.html">get_iterative_args_default()</a></code> for description of the arguments and their default values.</p></dd>


<dt id="arg-output-args">output_args<a class="anchor" aria-label="anchor" href="#arg-output-args"></a></dt>
<dd><p>Named list.
Specifies certain arguments related to the output of the function.
See <code><a href="get_output_args_default.html">get_output_args_default()</a></code> for description of the arguments and their default values.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="setup_approach.html">setup_approach.categorical</a></code>, <code><a href="setup_approach.html">setup_approach.copula</a></code>, <code><a href="setup_approach.html">setup_approach.ctree</a></code>, <code><a href="setup_approach.html">setup_approach.empirical</a></code>, <code><a href="setup_approach.html">setup_approach.gaussian</a></code>, <code><a href="setup_approach.html">setup_approach.independence</a></code>, <code><a href="setup_approach.html">setup_approach.regression_separate</a></code>, <code><a href="setup_approach.html">setup_approach.regression_surrogate</a></code>, <code><a href="setup_approach.html">setup_approach.timeseries</a></code>, <code><a href="setup_approach.html">setup_approach.vaeac</a></code></p><dl><dt><code>categorical.joint_prob_dt</code></dt>
<dd><p>Data.table. (Optional)
Containing the joint probability distribution for each combination of feature
values.
<code>NULL</code> means it is estimated from the <code>x_train</code> and <code>x_explain</code>.</p></dd>

    <dt><code>categorical.epsilon</code></dt>
<dd><p>Numeric value. (Optional)
If <code>categorical.joint_prob_dt</code> is not supplied, probabilities/frequencies are
estimated using <code>x_train</code>. If certain observations occur in <code>x_explain</code> and NOT in <code>x_train</code>,
then epsilon is used as the proportion of times that these observations occur in the training data.
In theory, this proportion should be zero, but this causes an error later in the Shapley computation.</p></dd>

    <dt><code>internal</code></dt>
<dd><p>List.
Not used directly, but passed through from <code>explain()</code>.</p></dd>

    <dt><code>ctree.mincriterion</code></dt>
<dd><p>Numeric scalar or vector.
Either a scalar or vector of length equal to the number of features in the model.
The value is equal to 1 - \(\alpha\) where \(\alpha\) is the nominal level of the conditional independence tests.
If it is a vector, this indicates which value to use when conditioning on various numbers of features.
The default value is 0.95.</p></dd>

    <dt><code>ctree.minsplit</code></dt>
<dd><p>Numeric scalar.
Determines the minimum value that the sum of the left and right daughter nodes must reach for a split.
The default value is 20.</p></dd>

    <dt><code>ctree.minbucket</code></dt>
<dd><p>Numeric scalar.
Determines the minimum sum of weights in a terminal node required for a split.
The default value is 7.</p></dd>

    <dt><code>ctree.sample</code></dt>
<dd><p>Boolean.
If <code>TRUE</code> (default), then the method always samples <code>n_MC_samples</code> observations from the leaf nodes
(with replacement).
If <code>FALSE</code> and the number of observations in the leaf node is less than <code>n_MC_samples</code>,
the method will take all observations in the leaf.
If <code>FALSE</code> and the number of observations in the leaf node is more than <code>n_MC_samples</code>,
the method will sample <code>n_MC_samples</code> observations (with replacement).
This means that there will always be sampling in the leaf unless
<code>sample = FALSE</code> <em>and</em> the number of obs in the node is less than <code>n_MC_samples</code>.</p></dd>

    <dt><code>empirical.type</code></dt>
<dd><p>Character. (default = <code>"fixed_sigma"</code>)
Must be one of <code>"independence"</code>, <code>"fixed_sigma"</code>, <code>"AICc_each_k"</code>, or <code>"AICc_full"</code>.
Note: <code>"empirical.type = independence"</code> is deprecated; use <code>approach = "independence"</code> instead.
<code>"fixed_sigma"</code> uses a fixed bandwidth (set through <code>empirical.fixed_sigma</code>) in the kernel density estimation.
<code>"AICc_each_k"</code> and <code>"AICc_full"</code> optimize the bandwidth using the AICc criterion, with respectively
one bandwidth per coalition size and one bandwidth for all coalition sizes.</p></dd>

    <dt><code>empirical.eta</code></dt>
<dd><p>Numeric scalar.
Needs to be <code>0 &lt; eta &lt;= 1</code>.
The default value is 0.95.
Represents the minimum proportion of the total empirical weight that data samples should use.
For example, if <code>eta = .8</code>, we choose the <code>K</code> samples with the largest weights so that the sum of the weights
accounts for 80\<!-- % of the total weight. -->
<code>eta</code> is the \(\eta\) parameter in equation (15) of
<a href="https://martinjullum.com/publication/aas-2021-explaining/aas-2021-explaining.pdf" class="external-link">Aas et al. (2021)</a>.</p></dd>

    <dt><code>empirical.fixed_sigma</code></dt>
<dd><p>Positive numeric scalar.
The default value is 0.1.
Represents the kernel bandwidth in the distance computation used when conditioning on all different coalitions.
Only used when <code>empirical.type = "fixed_sigma"</code></p></dd>

    <dt><code>empirical.n_samples_aicc</code></dt>
<dd><p>Positive integer.
Number of samples to consider in AICc optimization.
The default value is 1000.
Only used when <code>empirical.type</code> is either <code>"AICc_each_k"</code> or <code>"AICc_full"</code>.</p></dd>

    <dt><code>empirical.eval_max_aicc</code></dt>
<dd><p>Positive integer.
Maximum number of iterations when optimizing the AICc.
The default value is 20.
Only used when <code>empirical.type</code> is either <code>"AICc_each_k"</code> or <code>"AICc_full"</code>.</p></dd>

    <dt><code>empirical.start_aicc</code></dt>
<dd><p>Numeric.
Start value of the <code>sigma</code> parameter when optimizing the AICc.
The default value is 0.1.
Only used when <code>empirical.type</code> is either <code>"AICc_each_k"</code> or <code>"AICc_full"</code>.</p></dd>

    <dt><code>empirical.cov_mat</code></dt>
<dd><p>Numeric matrix. (Optional)
The covariance matrix of the data generating distribution used to define the Mahalanobis distance.
<code>NULL</code> means it is estimated from <code>x_train</code>.</p></dd>

    <dt><code>gaussian.mu</code></dt>
<dd><p>Numeric vector. (Optional)
Containing the mean of the data generating distribution.
<code>NULL</code> means it is estimated from the <code>x_train</code>.</p></dd>

    <dt><code>gaussian.cov_mat</code></dt>
<dd><p>Numeric matrix. (Optional)
Containing the covariance matrix of the data generating distribution.
<code>NULL</code> means it is estimated from the <code>x_train</code>.</p></dd>

    <dt><code>regression.model</code></dt>
<dd><p>A <code>tidymodels</code> object of class <code>model_specs</code>. Default is a linear regression model, i.e.,
<code><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">parsnip::linear_reg()</a></code>. See <a href="https://www.tidymodels.org/find/parsnip/" class="external-link">tidymodels</a> for all possible models,
and see the vignette for how to add new/own models. Note, to make it easier to call <code>explain()</code> from Python, the
<code>regression.model</code> parameter can also be a string specifying the model which will be parsed and evaluated. For
example, <code>"parsnip::rand_forest(mtry = hardhat::tune(), trees = 100, engine = "ranger", mode = "regression")"</code>
is also a valid input. It is essential to include the package prefix if the package is not loaded.</p></dd>

    <dt><code>regression.tune_values</code></dt>
<dd><p>Either <code>NULL</code> (default), a data.frame/data.table/tibble, or a function.
The data.frame must contain the possible hyperparameter value combinations to try.
The column names must match the names of the tunable parameters specified in <code>regression.model</code>.
If <code>regression.tune_values</code> is a function, then it should take one argument <code>x</code> which is the training data
for the current coalition and returns a data.frame/data.table/tibble with the properties described above.
Using a function allows the hyperparameter values to change based on the size of the coalition See the regression
vignette for several examples.
Note, to make it easier to call <code>explain()</code> from Python, the <code>regression.tune_values</code> can also be a string
containing an R function. For example,
<code>"function(x) return(dials::grid_regular(dials::mtry(c(1, ncol(x)))), levels = 3))"</code> is also a valid input.
It is essential to include the package prefix if the package is not loaded.</p></dd>

    <dt><code>regression.vfold_cv_para</code></dt>
<dd><p>Either <code>NULL</code> (default) or a named list containing
the parameters to be sent to <code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">rsample::vfold_cv()</a></code>. See the regression vignette for
several examples.</p></dd>

    <dt><code>regression.recipe_func</code></dt>
<dd><p>Either <code>NULL</code> (default) or a function that that takes in a <code><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipes::recipe()</a></code>
object and returns a modified <code><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipes::recipe()</a></code> with potentially additional recipe steps. See the regression
vignette for several examples.
Note, to make it easier to call <code>explain()</code> from Python, the <code>regression.recipe_func</code> can also be a string
containing an R function. For example,
<code>"function(recipe) return(recipes::step_ns(recipe, recipes::all_numeric_predictors(), deg_free = 2))"</code> is also
a valid input. It is essential to include the package prefix if the package is not loaded.</p></dd>

    <dt><code>regression.surrogate_n_comb</code></dt>
<dd><p>Positive integer.
Specifies the number of unique coalitions to apply to each training observation.
The default is the number of sampled coalitions in the present iteration.
Any integer between 1 and the default is allowed.
Larger values requires more memory, but may improve the surrogate model.
If the user sets a value lower than the maximum, we sample this amount of unique coalitions
separately for each training observations.
That is, on average, all coalitions should be equally trained.</p></dd>

    <dt><code>timeseries.fixed_sigma</code></dt>
<dd><p>Positive numeric scalar.
Represents the kernel bandwidth in the distance computation.
The default value is 2.</p></dd>

    <dt><code>timeseries.bounds</code></dt>
<dd><p>Numeric vector of length two.
Specifies the lower and upper bounds of the timeseries.
The default is <code>c(NULL, NULL)</code>, i.e. no bounds.
If one or both of these bounds are not <code>NULL</code>, we restrict the sampled time series to be between these bounds.
This is useful if the underlying time series are scaled between 0 and 1, for example.</p></dd>

    <dt><code>vaeac.depth</code></dt>
<dd><p>Positive integer (default is <code>3</code>). The number of hidden layers
in the neural networks of the masked encoder, full encoder, and decoder.</p></dd>

    <dt><code>vaeac.width</code></dt>
<dd><p>Positive integer (default is <code>32</code>). The number of neurons in each
hidden layer in the neural networks of the masked encoder, full encoder, and decoder.</p></dd>

    <dt><code>vaeac.latent_dim</code></dt>
<dd><p>Positive integer (default is <code>8</code>). The number of dimensions in the latent space.</p></dd>

    <dt><code>vaeac.lr</code></dt>
<dd><p>Positive numeric (default is <code>0.001</code>). The learning rate used in the <code><a href="https://torch.mlverse.org/docs/reference/optim_adam.html" class="external-link">torch::optim_adam()</a></code> optimizer.</p></dd>

    <dt><code>vaeac.activation_function</code></dt>
<dd><p>An <code><a href="https://torch.mlverse.org/docs/reference/nn_module.html" class="external-link">torch::nn_module()</a></code> representing an activation function such as, e.g.,
<code><a href="https://torch.mlverse.org/docs/reference/nn_relu.html" class="external-link">torch::nn_relu()</a></code> (default), <code><a href="https://torch.mlverse.org/docs/reference/nn_leaky_relu.html" class="external-link">torch::nn_leaky_relu()</a></code>, <code><a href="https://torch.mlverse.org/docs/reference/nn_selu.html" class="external-link">torch::nn_selu()</a></code>, or <code><a href="https://torch.mlverse.org/docs/reference/nn_sigmoid.html" class="external-link">torch::nn_sigmoid()</a></code>.</p></dd>

    <dt><code>vaeac.n_vaeacs_initialize</code></dt>
<dd><p>Positive integer (default is <code>4</code>). The number of different vaeac models to initiate
in the start. Pick the best performing one after <code>vaeac.extra_parameters$epochs_initiation_phase</code>
epochs (default is <code>2</code>) and continue training that one.</p></dd>

    <dt><code>vaeac.epochs</code></dt>
<dd><p>Positive integer (default is <code>100</code>). The number of epochs to train the final vaeac model.
This includes <code>vaeac.extra_parameters$epochs_initiation_phase</code>, where the default is <code>2</code>.</p></dd>

    <dt><code>vaeac.extra_parameters</code></dt>
<dd><p>Named list with extra parameters to the <code>vaeac</code> approach. See
<code><a href="vaeac_get_extra_para_default.html">vaeac_get_extra_para_default()</a></code> for description of possible additional parameters and their default values.</p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Object of class <code>c("shapr", "list")</code>. Contains the following items:</p><dl><dt><code>shapley_values_est</code></dt>
<dd><p>data.table with the estimated Shapley values with explained observation in the rows and
features along the columns.
The column <code>none</code> is the prediction not devoted to any of the features (given by the argument <code>phi0</code>)</p></dd>

<dt><code>shapley_values_sd</code></dt>
<dd><p>data.table with the standard deviation of the Shapley values reflecting the uncertainty
in the coalition sampling part of the kernelSHAP procedure.
These are, by definition, 0 when all coalitions are used.
Only present when <code>extra_computation_args$compute_sd=TRUE</code>, which is the default when <code>iterative = TRUE</code>.</p></dd>

<dt><code>internal</code></dt>
<dd><p>List with the different parameters, data, functions and other output used internally.</p></dd>

<dt><code>pred_explain</code></dt>
<dd><p>Numeric vector with the predictions for the explained observations.</p></dd>

<dt><code>MSEv</code></dt>
<dd><p>List with the values of the MSEv evaluation criterion for the approach. See the
<a href="https://norskregnesentral.github.io/shapr/articles/general_usage.html#msev-evaluation-criterion%0A">MSEv evaluation section in the general usage vignette for details</a>.</p></dd>

<dt><code>timing</code></dt>
<dd><p>List containing timing information for the different parts of the computation.
<code>summary</code> contains the time stamps for the start and end time in addition to the total execution time.
<code>overall_timing_secs</code> gives the time spent on different parts of the explanation computation.
<code>main_computation_timing_secs</code> further decomposes the main computation time into different parts of the
computation for each iteration of the iterative estimation routine, if used.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>shapr</code> package implements kernelSHAP estimation of dependence-aware Shapley values with
eight different Monte Carlo-based approaches for estimating the conditional distributions of the data.
These are all introduced in the
<a href="https://norskregnesentral.github.io/shapr/articles/general_usage.html">general usage vignette</a>.
(From R: <code><a href="../articles/general_usage.html">vignette("general_usage", package = "shapr")</a></code>).
For an overview of the methodology and capabilities of the package, please also see the software paper
<a href="https://arxiv.org/pdf/2504.01842" class="external-link">Jullum et al. (2025)</a>.
Moreover,
<a href="https://martinjullum.com/publication/aas-2021-explaining/aas-2021-explaining.pdf" class="external-link">Aas et al. (2021)</a>
gives a general introduction to dependence-aware Shapley values and the approaches <code>"empirical"</code>,
<code>"gaussian"</code>, <code>"copula"</code>, and also discusses <code>"independence"</code>.
<a href="https://martinjullum.com/publication/redelmeier-2020-explaining/redelmeier-2020-explaining.pdf" class="external-link">
Redelmeier et al. (2020)</a> introduces the approach <code>"ctree"</code>.
<a href="https://www.jmlr.org/papers/volume23/21-1413/21-1413.pdf" class="external-link">Olsen et al. (2022)</a> introduces the <code>"vaeac"</code>
approach.
Approach <code>"timeseries"</code> is discussed in
<a href="https://martinjullum.com/publication/jullum-2021-efficient/jullum-2021-efficient.pdf" class="external-link">Jullum et al. (2021)</a>.
<code>shapr</code> has also implemented two regression-based approaches <code>"regression_separate"</code> and <code>"regression_surrogate"</code>,
as described in <a href="https://link.springer.com/content/pdf/10.1007/s10618-024-01016-z.pdf" class="external-link">Olsen et al. (2024)</a>.
It is also possible to combine the different approaches, see the
<a href="https://norskregnesentral.github.io/shapr/articles/general_usage.html">
general usage</a> vignette for more information.</p>
<p>The package also supports the computation of causal and asymmetric Shapley values as introduced by
<a href="https://proceedings.neurips.cc/paper/2020/file/32e54441e6382a7fbacbbbaf3c450059-Paper.pdf" class="external-link">
Heskes et al. (2020)</a> and
<a href="https://proceedings.neurips.cc/paper_files/paper/2020/file/0d770c496aa3da6d2c3f2bd19e7b9d6b-Paper.pdf" class="external-link">
Frye et al. (2020)</a>.
Asymmetric Shapley values were proposed by
<a href="https://proceedings.neurips.cc/paper_files/paper/2020/file/0d770c496aa3da6d2c3f2bd19e7b9d6b-Paper.pdf" class="external-link">
Frye et al. (2020)</a> as a way to incorporate causal knowledge in
the real world by restricting the possible feature combinations/coalitions when computing the Shapley values to
those consistent with a (partial) causal ordering.
Causal Shapley values were proposed by
<a href="https://proceedings.neurips.cc/paper/2020/file/32e54441e6382a7fbacbbbaf3c450059-Paper.pdf" class="external-link">
Heskes et al. (2020)</a> as a way to explain the total effect of features
on the prediction, taking into account their causal relationships, by adapting the sampling procedure in <code>shapr</code>.</p>
<p>The package allows parallelized computation with progress updates through the tightly connected
<a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future</a> and <a href="https://progressr.futureverse.org/reference/progressr.html" class="external-link">progressr::progressr</a> packages.
See the examples below.
For iterative estimation (<code>iterative=TRUE</code>), intermediate results may be printed to the console
(according to the <code>verbose</code> argument).
Moreover, the intermediate results are written to disk.
This combined batch computation of the v(S) values enables fast and accurate estimation of the Shapley values
in a memory-friendly manner.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p><a href="https://arxiv.org/pdf/2504.01842" class="external-link">
Jullum, M., Olsen, L. H. B., Lachmann, J., &amp; Redelmeier, A. (2025). shapr: Explaining Machine Learning Models
with Conditional Shapley Values in R and Python. arXiv preprint arXiv:2504.01842.</a></p></li>
<li><p><a href="https://martinjullum.com/publication/aas-2021-explaining/aas-2021-explaining.pdf" class="external-link">
Aas, K., Jullum, M., &amp; Løland, A. (2021). Explaining individual predictions when features are dependent:
More accurate approximations to Shapley values. Artificial Intelligence, 298, 103502</a></p></li>
<li><p><a href="https://proceedings.neurips.cc/paper_files/paper/2020/file/0d770c496aa3da6d2c3f2bd19e7b9d6b-Paper.pdf" class="external-link">
Frye, C., Rowat, C., &amp; Feige, I. (2020). Asymmetric Shapley values:
incorporating causal knowledge into model-agnostic explainability.
Advances in neural information processing systems, 33, 1229-1239</a></p></li>
<li><p><a href="https://proceedings.neurips.cc/paper/2020/file/32e54441e6382a7fbacbbbaf3c450059-Paper.pdf" class="external-link">
Heskes, T., Sijben, E., Bucur, I. G., &amp; Claassen, T. (2020). Causal shapley values:
Exploiting causal knowledge to explain individual predictions of complex models.
Advances in neural information processing systems, 33, 4778-4789</a></p></li>
<li><p><a href="https://martinjullum.com/publication/jullum-2021-efficient/jullum-2021-efficient.pdf" class="external-link">
Jullum, M., Redelmeier, A. &amp; Aas, K. (2021). Efficient and simple prediction explanations with
groupShapley: A practical perspective. Italian Workshop on Explainable Artificial Intelligence 2021.</a></p></li>
<li><p><a href="https://martinjullum.com/publication/redelmeier-2020-explaining/redelmeier-2020-explaining.pdf" class="external-link">
Redelmeier, A., Jullum, M., &amp; Aas, K. (2020). Explaining predictive models with mixed features using Shapley
values and conditional inference trees. In Machine Learning and Knowledge Extraction:
International Cross-Domain Conference, CD-MAKE 2020, Dublin, Ireland, August 25-28, 2020, Proceedings 4
(pp. 117-137). Springer International Publishing.</a></p></li>
<li><p><a href="https://www.theoj.org/joss-papers/joss.02027/10.21105.joss.02027.pdf" class="external-link">
Sellereite N., &amp; Jullum, M. (2019). shapr: An R-package for explaining machine learning models with
dependence-aware Shapley values. Journal of Open Source Software, 5(46), 2027</a></p></li>
<li><p><a href="https://www.jmlr.org/papers/volume23/21-1413/21-1413.pdf" class="external-link">
Olsen, L. H., Glad, I. K., Jullum, M., &amp; Aas, K. (2022). Using Shapley values and variational autoencoders to
explain predictive models with dependent mixed features. Journal of machine learning research, 23(213), 1-51</a></p></li>
<li><p><a href="https://link.springer.com/content/pdf/10.1007/s10618-024-01016-z.pdf" class="external-link">
Olsen, L. H. B., Glad, I. K., Jullum, M., &amp; Aas, K. (2024). A comparative study of methods for estimating
model-agnostic Shapley value explanations. Data Mining and Knowledge Discovery, 1-48</a></p></li>
<li><p><a href="https://arxiv.org/pdf/2410.04883" class="external-link">
Olsen, L. H. B., &amp; Jullum, M. (2024). Improving the Sampling Strategy in KernelSHAP. arXiv e-prints, arXiv-2410</a></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Martin Jullum, Lars Henry Berge Olsen</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"airquality"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">airquality</span> <span class="op">&lt;-</span> <span class="va">airquality</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Solar.R"</span>, <span class="st">"Wind"</span>, <span class="st">"Temp"</span>, <span class="st">"Month"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y_var</span> <span class="op">&lt;-</span> <span class="st">"Ozone"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Split data into test and training data</span></span></span>
<span class="r-in"><span><span class="va">data_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">airquality</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_explain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">airquality</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">data_train</span><span class="op">[</span>, <span class="va">x_var</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x_explain</span> <span class="op">&lt;-</span> <span class="va">data_explain</span><span class="op">[</span>, <span class="va">x_var</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit a linear model</span></span></span>
<span class="r-in"><span><span class="va">lm_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">y_var</span>, <span class="st">" ~ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x_var</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">data_train</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Explain predictions</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">[</span>, <span class="va">y_var</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (Optionally) enable parallelization via the future package</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"future"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (Optionally) enable progress updates within every iteration via the progressr package</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"progressr"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in globalCallingHandlers(condition = global_progression_handler):</span> should not be called with handlers on the stack</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Empirical approach</span></span></span>
<span class="r-in"><span><span class="va">explain1</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>  x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>  approach <span class="op">=</span> <span class="st">"empirical"</span>,</span></span>
<span class="r-in"><span>  phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:52:53</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">empirical</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f7828c6cb8d.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Gaussian approach</span></span></span>
<span class="r-in"><span><span class="va">explain2</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>  x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>  approach <span class="op">=</span> <span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>  phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:52:57</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">gaussian</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f7826970139.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Gaussian copula approach</span></span></span>
<span class="r-in"><span><span class="va">explain3</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>  x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>  approach <span class="op">=</span> <span class="st">"copula"</span>,</span></span>
<span class="r-in"><span>  phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:52:59</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">copula</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f7851f9b05b.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"party"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># ctree approach</span></span></span>
<span class="r-in"><span>  <span class="va">explain4</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>    x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>    x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>    approach <span class="op">=</span> <span class="st">"ctree"</span>,</span></span>
<span class="r-in"><span>    phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>    n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:53:00</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">ctree</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f786671b284.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combined approach</span></span></span>
<span class="r-in"><span><span class="va">approach</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="st">"gaussian"</span>, <span class="st">"empirical"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">explain5</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>  x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>  approach <span class="op">=</span> <span class="va">approach</span>,</span></span>
<span class="r-in"><span>  phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:53:03</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">gaussian</span>, <span style="color: #0000BB;">gaussian</span>, and <span style="color: #0000BB;">empirical</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f784d62e7cb.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Printing</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explain1</span><span class="op">)</span> <span class="co"># The Shapley values</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    explain_id  none Solar.R   Wind   Temp Month</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;int&gt; &lt;num&gt;   &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:          1  42.8    6.12 -20.14  -5.03 -5.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:          2  42.8   -1.47  11.53  -9.49 -5.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:          3  42.8    3.52  -5.34 -16.60 -8.70</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explain1</span><span class="op">)</span> <span class="co"># The Shapley values</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    explain_id  none Solar.R   Wind   Temp Month</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;int&gt; &lt;num&gt;   &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:          1  42.8    6.12 -20.14  -5.03 -5.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:          2  42.8   -1.47  11.53  -9.49 -5.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:          3  42.8    3.52  -5.34 -16.60 -8.70</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The MSEv criterion (+sd). Smaller values indicate a better approach.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explain1</span>, what <span class="op">=</span> <span class="st">"MSEv"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     MSEv MSEv_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;num&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:   233    81.6</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explain2</span>, what <span class="op">=</span> <span class="st">"MSEv"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     MSEv MSEv_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;num&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:   249    90.1</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explain3</span>, what <span class="op">=</span> <span class="st">"MSEv"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     MSEv MSEv_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;num&gt;   &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:   210    73.3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Summary</span></span></span>
<span class="r-in"><span><span class="va">summary1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">explain1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Summary of Shapley value explanation</span> <span style="color: #00BBBB;">────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computed with`shapr::explain()` in <span style="color: #00BB00;">3.4 seconds</span>, started <span style="color: #0000BB;">2025-08-25 20:52:53</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">empirical</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of coalitions used: <span style="color: #0000BB;">16</span> (of total <span style="color: #0000BB;">16</span>)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f7828c6cb8d.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Estimated Shapley values </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    explain_id   none Solar.R   Wind   Temp  Month</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>         &lt;int&gt; &lt;char&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1:          1  42.79    6.12 -20.14  -5.03  -5.99</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2:          2  42.79   -1.47  11.53  -9.49  -5.60</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3:          3  42.79    3.52  -5.34 -16.60  -8.70</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Estimated MSEv </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated MSE of v(S) = <span style="color: #0000BB;">233</span> (with sd = <span style="color: #0000BB;">82</span>)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Various additional info stored in the summary object</span></span></span>
<span class="r-in"><span><span class="co"># Examples</span></span></span>
<span class="r-in"><span><span class="va">summary1</span><span class="op">$</span><span class="va">shapley_est</span> <span class="co"># A data.table with the Shapley values</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    explain_id     none   Solar.R       Wind       Temp     Month</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;int&gt;    &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:          1 42.78704  6.124296 -20.137653  -5.033967 -5.987303</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:          2 42.78704 -1.470838  11.525868  -9.487924 -5.597657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:          3 42.78704  3.524599  -5.335059 -16.599988 -8.703929</span>
<span class="r-in"><span><span class="va">summary1</span><span class="op">$</span><span class="va">timing</span><span class="op">$</span><span class="va">total_time_secs</span> <span class="co"># Total computation time in seconds</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="va">summary1</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">n_MC_samples</span> <span class="co"># Number of Monte Carlo samples used for the numerical integration</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-in"><span><span class="va">summary1</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">empirical.type</span> <span class="co"># Type of empirical approach used</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "fixed_sigma"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the results</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">explain1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">explain1</span>, plot_type <span class="op">=</span> <span class="st">"waterfall"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="explain-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Group-wise explanations</span></span></span>
<span class="r-in"><span><span class="va">group_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Temp"</span>, <span class="st">"Month"</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wind"</span>, <span class="st">"Solar.R"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">explain_groups</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>  x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="va">group_list</span>,</span></span>
<span class="r-in"><span>  approach <span class="op">=</span> <span class="st">"empirical"</span>,</span></span>
<span class="r-in"><span>  phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  n_MC_samples <span class="op">=</span> <span class="fl">1e2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:53:07</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_groups = 4`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_groups = 4`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">empirical</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">100</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">group-wise</span> Shapley values: <span style="color: #0000BB;">2</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Feature groups: <span style="font-style: italic;">A</span>: {<span style="color: #0000BB;">"Temp"</span>, <span style="color: #0000BB;">"Month"</span>}; <span style="font-style: italic;">B</span>: {<span style="color: #0000BB;">"Wind"</span>, <span style="color: #0000BB;">"Solar.R"</span>}</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f78277c1b3.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">4</span> of <span style="color: #0000BB;">4</span> coalitions. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explain_groups</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    explain_id  none     A      B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;int&gt; &lt;num&gt; &lt;num&gt;  &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:          1  42.8 -11.6 -13.40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:          2  42.8 -10.4   5.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:          3  42.8 -25.8  -1.32</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Separate and surrogate regression approaches with linear regression models.</span></span></span>
<span class="r-in"><span><span class="va">req_pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parsnip"</span>, <span class="st">"recipes"</span>, <span class="st">"workflows"</span>, <span class="st">"rsample"</span>, <span class="st">"tune"</span>, <span class="st">"yardstick"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="va">req_pkgs</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">explain_separate_lm</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>    x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>    x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>    phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>    approach <span class="op">=</span> <span class="st">"regression_separate"</span>,</span></span>
<span class="r-in"><span>    regression.model <span class="op">=</span> <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">explain_surrogate_lm</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>    x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>    x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>    phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>    approach <span class="op">=</span> <span class="st">"regression_surrogate"</span>,</span></span>
<span class="r-in"><span>    regression.model <span class="op">=</span> <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:53:10</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Regression</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">regression_separate</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f78729022bf.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:53:13</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `max_n_coalitions` is `NULL` or larger than `2^n_features = 16`, and is</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   therefore set to `2^n_features = 16`.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Regression</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">regression_surrogate</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Non-iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f78d9e1ce5.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Main computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">16</span> of <span style="color: #0000BB;">16</span> coalitions. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Iterative estimation</span></span></span>
<span class="r-in"><span><span class="co"># For illustration only. By default not used for such small dimensions as here.</span></span></span>
<span class="r-in"><span><span class="co"># Restricting the initial and maximum number of coalitions as well.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">explain_iterative</span> <span class="op">&lt;-</span> <span class="fu">explain</span><span class="op">(</span></span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  x_explain <span class="op">=</span> <span class="va">x_explain</span>,</span></span>
<span class="r-in"><span>  x_train <span class="op">=</span> <span class="va">x_train</span>,</span></span>
<span class="r-in"><span>  approach <span class="op">=</span> <span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>  phi0 <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  iterative <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  iterative_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial_n_coalitions <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  max_n_coalitions <span class="op">=</span> <span class="fl">12</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Starting `shapr::explain()` at </span><span style="color: #0000BB; font-weight: bold;">2025-08-25 20:53:15</span> <span style="color: #00BBBB;">──────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Explanation overview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">gaussian</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">1000</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f7878fd6759.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #0000BB; font-weight: bold;">Iterative computation started</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Iteration </span><span style="color: #0000BB; font-weight: bold;">1</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">8</span> of <span style="color: #0000BB;">16</span> coalitions, <span style="color: #0000BB;">8</span> new. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Iteration </span><span style="color: #0000BB; font-weight: bold;">2</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">10</span> of <span style="color: #0000BB;">16</span> coalitions, <span style="color: #0000BB;">2</span> new. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Iteration </span><span style="color: #0000BB; font-weight: bold;">3</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using <span style="color: #0000BB;">12</span> of <span style="color: #0000BB;">16</span> coalitions, <span style="color: #0000BB;">2</span> new. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># When not using all coalitions, we can also get the SD of the Shapley values,</span></span></span>
<span class="r-in"><span><span class="co"># reflecting uncertainty in the coalition sampling part of the procedure.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explain_iterative</span>, what <span class="op">=</span> <span class="st">"shapley_sd"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    explain_id  none Solar.R  Wind  Temp Month</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;int&gt; &lt;num&gt;   &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:          1     0   0.306  1.58  1.71 0.523</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:          2     0   0.342  2.53  2.47 0.643</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:          3     0   0.316  2.91  2.84 0.692</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Summary</span></span></span>
<span class="r-in"><span><span class="co"># For iterative estimation, convergence info is also provided</span></span></span>
<span class="r-in"><span><span class="va">summary_iterative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">explain_iterative</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Summary of Shapley value explanation</span> <span style="color: #00BBBB;">────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computed with`shapr::explain()` in <span style="color: #00BB00;">8.5 seconds</span>, started <span style="color: #0000BB;">2025-08-25 20:53:15</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Model class: <span style="color: #0000BB;">&lt;lm&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • v(S) estimation class: <span style="color: #0000BB;">Monte Carlo integration</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Approach: <span style="color: #0000BB;">gaussian</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Procedure: <span style="color: #0000BB;">Iterative</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of Monte Carlo integration samples: <span style="color: #0000BB;">1000</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of <span style="font-style: italic;">feature-wise</span> Shapley values: <span style="color: #0000BB;">4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of observations to explain: <span style="color: #0000BB;">3</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of coalitions used: <span style="color: #0000BB;">12</span> (of total <span style="color: #0000BB;">16</span>)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Computations (temporary) saved at: <span style="color: #0000BB;">/tmp/RtmpHOvW0M/shapr_obj_1f7878fd6759.rds</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Convergence info </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Iterative Shapley value estimation stopped at <span style="color: #0000BB;">12</span> coalitions after <span style="color: #0000BB;">3</span> iterations, due to:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Maximum number of coalitions (<span style="color: #0000BB;">12</span>) reached!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Estimated Shapley values (sd in parentheses) </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    explain_id      none      Solar.R          Wind          Temp        Month</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>         &lt;int&gt;    &lt;char&gt;       &lt;char&gt;        &lt;char&gt;        &lt;char&gt;       &lt;char&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1:          1 42.79 (0)  2.02 (0.31) -19.30 (1.58)  -6.99 (1.71) -0.76 (0.52)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2:          2 42.79 (0) -3.30 (0.34)   8.77 (2.53)  -9.44 (2.47) -1.06 (0.64)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3:          3 42.79 (0)  5.34 (0.32)  -4.86 (2.91) -25.85 (2.84) -1.75 (0.69)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Estimated MSEv </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated MSE of v(S) = <span style="color: #0000BB;">247</span> (with sd = <span style="color: #0000BB;">101</span>)</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Jullum, Lars Henry Berge Olsen, Annabelle Redelmeier, Jon Lachmann, Nikolai Sellereite, Norsk Regnesentral.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

