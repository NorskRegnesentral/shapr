
# Reproduction guidelines

Below we describe how to reproduce the code and figure examples in the paper
"shapr: Explaining Machine Learning Models with Conditional Shapley Values in R and Python"

*The instructions assume a Linux-like environment and that the commands are executed from the directory containing this file.*
*Execution from other locations or on different operating systems requires adjustments.*

*The code in the paper is run on Ubuntu 24.04.3 LTS with R 4.3.3 and Python 3.12.3 installed.*

## Folder content

The folder contains the following files:

- `README-reproduce.md`: This file.

#### Code files
- `code_R.R`: The R code used to generate the results and figures in the paper.
- `code_py.py`: The Python code used to generate the results and figures in the paper.
- `R_prep_data_and_model.R`: An R script that generates the data and models used in the examples, and save them in the `data_and_models` directory (i.e. it is not necessary to run this script).
- `code_py_to_html.sh`: A bash script that converts the Python code to HTML using `jupyter`, `jupytext`, `nbconvert` and `ipykernel`.

#### Output files and folders
- `data_and_models/`: A folder containing the data and models used in the examples, as generated by `R_prep_data_and_model.R`.
- `code_R.html`: The HTML file generated by `code_R.R`, containing the R code, its output and basic session information.
- `code_py.html`: The HTML file generated by `code_py_to_html.sh` bash script, containing the Python code, its output and basic session information.
- `paper_figures/`: A folder containing the figures for the examples used in the paper, generated by `code_R.R`.
- `html_figures/`: A folder containing the figures for the examples used in the HTML file, generated by `code_R.R`.

## Additional installation instructions for reproducing examples
To run the scripts that generate the results and figures in the paper, additional libraries are required,
in addition to the `shapr` R package and the `shaprpy` Python library and their direct dependencies.

### R

Install the additional R packages needed for the reproduction scripts:

```bash
Rscript -e "install.packages(c('xgboost', 'party', 'parsnip', 'recipes', 'workflows', 'tune', 'progressr', 'forecast', 'markdown', 'knitr', 'ggplot2', 'ggbeeswarm', 'patchwork'), repos='https://cran.rstudio.com')"
```

### Python

Install the additional Python packages needed for the reproduction scripts:

```bash
pip install xgboost session_info jupyter jupytext nbconvert ipykernel
```
**Note:**
The `jupyter`, `jupytext`, `nbconvert`, and `ipykernel` packages are only needed to run the `code_py_to_html.sh` bash script that generates the HTML file from the Python code. The Python code itself does not require these packages.


## Commands to reproduce the examples

### R
**Preparation (optional):**

The script `R_prep_data_and_model.R` prepares the data and models used in the examples.
Running this script is optional, since the prepared data and models are already included in the `data_and_models` folder.

To run the preparation script from the command line, use
```bash
Rscript R_prep_data_and_model.R
```

**Run the R code:**
To run the R code and generate the HTML file with the code and output in the actual paper, run
```bash
Rscript -e "knitr::spin('code_R.R')"
```
This will generate the file `code_R.html` containing the code from `code_R.R` accompanied with its output, as well as the figures in the `paper_figures` and `html_figures` folders.

### Python

To simplify the reproducability, we have created a simple bash script executing the Python code in a manner similar to how the `knitr::spin()` function operates for the `R` code.
The bash script requires the `jupyter`, `jupytext`, `nbconvert` and `ipykernel` libraries to run, which can be installed from pip as described above.

To run the Python code and generate the HTML file with the code and output in the actual paper, run
```bash
bash code_py_to_html.sh
```
This will generate the file `code_py.html` containing the code from `code_py.py` accompanied with it's output, basic session information and a figure in the `paper_figures` folder.

### Note
The html files displays the code used in the paper together with its output. Additional code used to mildly customize and save the figures is provided in the `code_R.R` and `code_py.py` files and executed by the bash scripts (`knitr::spin()` and `code_py_to_html.sh`), but not shown in the html-file.
